<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Uncontested Divorce Packet</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 p-6">
  <a href="/" class="text-sm text-gray-600">&larr; Home</a>
  <h1 class="text-3xl font-extrabold mt-2">Uncontested Divorce Packet</h1>
  <p class="text-gray-600 mb-4">Simple step-by-step packet.</p>

  <div class="bg-white p-4 rounded-lg border max-w-xl">
    <label class="block text-sm font-medium">Your Email</label>
    <input id="buyerEmail" class="border rounded p-2 w-full mb-3" placeholder="you@example.com">
    <label class="block text-sm font-medium">Your Name</label>
    <input id="buyerName" class="border rounded p-2 w-full mb-4" placeholder="Jane Doe">

    <button id="buyNow" class="bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 rounded w-full">
      Buy Now
    </button>
    <p class="text-xs text-gray-500 mt-2">You will be redirected to Stripe Checkout.</p>
  </div>

  <div class="mt-6 bg-white p-4 rounded-lg border">
    <div class="relative min-h-[160px]">
      <div id="preview" class="text-sm text-gray-800 whitespace-pre-wrap">
Draft: Uncontested Divorce Packet preview content…
      </div>
      <div class="absolute inset-0 pointer-events-none flex items-center justify-center text-6xl font-black text-emerald-500/10">
        UNPAID DRAFT
      </div>
    </div>
  </div>

<script>
const PRICE_ID = "price_XXXX_DIVORCE"; // 🔁 REPLACE
const SUCCESS_PATH = "/divorce/success.html";

function $(id){ return document.getElementById(id); }

async function saveDraft() {
  const email = $('buyerEmail').value.trim();
  const name  = $('buyerName').value.trim();
  const product = "Uncontested Divorce Packet";
  const content = $('preview').innerText || 'Draft content';
  const r = await fetch('/.netlify/functions/save-draft', {
    method:'POST', headers:{'Content-Type':'application/json'},
    body: JSON.stringify({ email, name, product, content })
  });
  if(!r.ok){ throw new Error('save-draft failed'); }
  return r.json();
}

$('buyNow').addEventListener('click', async () => {
  try {
    const email = $('buyerEmail').value.trim();
    if(!email){ alert('Enter your email'); return; }
    const { draftId } = await saveDraft();
    const r = await fetch('/.netlify/functions/create-checkout', {
      method:'POST', headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ draftId, email, priceId: PRICE_ID, successPath: SUCCESS_PATH })
    });
    if(!r.ok){ alert('Checkout failed'); return; }
    const { url } = await r.json();
    location.href = url;
  } catch (e) {
    console.error(e);
    alert('Problem starting checkout');
  }
});
</script>
</body>
</html>
