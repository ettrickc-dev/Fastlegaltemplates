<!DOCTYPE html><html lang="en"><head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Caregiver Services Agreement Generator</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
</head><body class="p-6 bg-gray-50">
  <a href="/" class="text-sm text-gray-600">&larr; Home</a>
  <h1 class="text-3xl font-extrabold mt-2">Caregiver Services Agreement</h1>
  <p class="text-gray-600 mb-4">Employee (W-2) or Independent Contractor (1099).</p>

  <!-- Email + Name (minimal for checkout) -->
  <div class="bg-white p-4 rounded-lg border max-w-xl">
    <label class="block text-sm font-medium">Your Email</label>
    <input id="buyerEmail" class="border rounded p-2 w-full mb-3" placeholder="you@example.com">
    <label class="block text-sm font-medium">Your Name</label>
    <input id="buyerName" class="border rounded p-2 w-full mb-3" placeholder="Jane Doe">
    <button id="startCheckout" class="bg-emerald-600 text-white px-4 py-2 rounded">Buy Now</button>
    <p class="text-xs text-gray-500 mt-2">Price is configured in Stripe (Price ID).</p>
  </div>

  <!-- Preview box -->
  <div class="mt-6 bg-white p-4 rounded-lg border">
    <div class="relative min-h-[200px]">
      <div id="preview" class="text-sm text-gray-800 whitespace-pre-wrap">Draft content previewâ€¦</div>
      <div class="absolute inset-0 pointer-events-none flex items-center justify-center text-6xl font-black text-emerald-500/10">UNPAID DRAFT</div>
    </div>
  </div>

<script>
// TODO: replace with your real Price ID from Stripe (test mode is fine)
const PRICE_ID = "price_XXXXX";

async function saveDraft() {
  const email = document.getElementById('buyerEmail').value.trim();
  const name = document.getElementById('buyerName').value.trim();
  const content = document.getElementById('preview').innerText;
  const product = "Caregiver Agreement";
  const r = await fetch('/.netlify/functions/save-draft', {
    method:'POST', headers:{'Content-Type':'application/json'},
    body: JSON.stringify({ email, name, product, content })
  });
  if(!r.ok) throw new Error('save-draft failed');
  return r.json(); // { draftId }
}

document.getElementById('startCheckout').addEventListener('click', async () => {
  try {
    const email = document.getElementById('buyerEmail').value.trim();
    if(!email) { alert('Enter your email'); return; }
    const { draftId } = await saveDraft();
    const r = await fetch('/.netlify/functions/create-checkout', {
      method:'POST', headers:{'Content-Type':'application/json'},
      body: JSON.stringify({
        draftId,
        email,
        priceId: PRICE_ID,
        successPath: '/caregiver/success.html'
      })
    });
    if(!r.ok){ alert('Checkout failed'); return; }
    const { url } = await r.json();
    location.href = url;
  } catch (e) {
    console.error(e);
    alert('Problem starting checkout');
  }
});
</script>
</body></html>
